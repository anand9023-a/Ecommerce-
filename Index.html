<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Raksha Bandhan — Flower Montage (30)</title>
<style>
  :root{
    --bg1:#fff7ed; --accent1:#ff7b7b; --gold:#ffd36b; --deep:#3b2b1a;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg1),#fff2df);color:var(--deep);overflow:hidden}
  .stage{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
  .frame{width:min(1200px,96vw);height:min(820px,94vh);border-radius:18px;overflow:hidden;position:relative;background:linear-gradient(180deg,#fff,#fff8f2);box-shadow:0 30px 80px rgba(55,30,10,0.08)}
  /* parallax layers */
  .layer{position:absolute;inset:0;pointer-events:none;z-index:1;transition:transform .2s}
  .petalsCanvas{position:absolute;inset:0;z-index:2;pointer-events:none}
  /* interactive area */
  .playArea{position:absolute;inset:0;z-index:4;padding:24px;display:flex;align-items:center;justify-content:center}
  .polaroid{position:absolute;width:320px;height:380px;border-radius:12px;background:#fff;padding:12px 12px 28px;box-shadow:0 22px 50px rgba(30,14,8,0.18);cursor:grab;touch-action:none;user-select:none;transition:transform .28s ease}
  .polaroid img{width:100%;height:82%;object-fit:cover;border-radius:8px;display:block}
  .label{margin-top:8px;font-weight:800;color:var(--deep);text-align:center;font-size:13px}
  .controls{position:absolute;right:20px;top:18px;display:flex;flex-direction:column;gap:10px;z-index:9}
  .btn{padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff;font-weight:700;cursor:pointer}
  .primary{background:linear-gradient(90deg,#ff8a65,#ffd180);border:0;color:#3b2b1a}
  .captionBox{position:absolute;left:28px;bottom:26px;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg, rgba(59,43,26,0.9), rgba(255,240,220,0.06));color:#fff;font-weight:700;z-index:10;backdrop-filter:blur(4px)}
  .overlayRakhi{position:absolute;left:50%;transform:translateX(-50%);top:14%;z-index:11;pointer-events:none}
  .rakhiBar{height:4px;background:linear-gradient(90deg,#c04a3b,#ffd36b);border-radius:6px;width:0;transform-origin:left}
  .rakhiKnot{width:36px;height:36px;border-radius:50%;background:radial-gradient(circle,#ffd36b,#ff6b5a);box-shadow:0 10px 22px rgba(255,120,90,0.25);opacity:0;transform:translateY(-6px) scale(.6)}
  .thumbs{display:flex;gap:8px;flex-wrap:wrap;max-width:260px}
  .thumbs img{width:58px;height:44px;object-fit:cover;border-radius:8px;border:2px solid rgba(0,0,0,0.04);cursor:pointer}
  .dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px;z-index:12}
  .dot{width:10px;height:10px;border-radius:50%;background:rgba(0,0,0,0.08)}
  .dot.active{background:var(--accent1);transform:scale(1.25)}
  footer{position:absolute;left:18px;top:18px;font-size:13px;color:var(--deep);z-index:9}
  @media (max-width:900px){
    .polaroid{width:240px;height:300px}
    .controls{right:8px;top:8px}
    .captionBox{left:12px;right:12px}
  }
  /* animations */
  @keyframes floaty { from{transform:translateY(0)} to{transform:translateY(-12px)} }
  .glowPulse{animation:floaty 3.6s ease-in-out infinite alternate}
</style>
</head>
<body>
  <div class="stage">
    <div class="frame" id="frame">
      <div class="layer" id="bgLayer"></div>
      <canvas class="petalsCanvas" id="petalsCanvas"></canvas>
      <div class="playArea" id="playArea"></div>

      <div class="overlayRakhi" id="overlayRakhi" aria-hidden="true" style="width:60%;">
        <div class="rakhiBar" id="rakhiBar"></div>
        <div style="height:8px"></div>
        <div class="rakhiKnot" id="rakhiKnot"></div>
      </div>

      <div class="captionBox" id="captionBox">Click <strong>Play</strong> — enjoy a flower story ✨</div>

      <div class="controls">
        <button class="btn primary" id="playBtn">Play Montage</button>
        <button class="btn" id="pauseBtn">Pause</button>
        <button class="btn" id="tieBtn">Tie Rakhi (effect)</button>
        <button class="btn" id="musicBtn">Play Music</button>
        <div class="thumbs" id="thumbs"></div>
        <div style="height:8px"></div>
        <button class="btn" id="exportBtn">Export Offline</button>
      </div>

      <div class="dots" id="dots"></div>
      <footer>Made with ♥ — Festive Flowers Montage</footer>
    </div>
  </div>

  <!-- background audio (free sample) -->
  <audio id="bgAudio" loop preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_4a6cb0b4d9.mp3?filename=romantic-acoustic-111986.mp3" type="audio/mpeg">
  </audio>

<script>
/* ========== CONFIG ========== */
/* We'll use Unsplash source with sig to get 30 distinct flower images */
const IMAGES_COUNT = 30;
const baseUrls = [];
for(let i=1;i<=IMAGES_COUNT;i++){
  // resolution can be large; adjust if needed
  baseUrls.push(`https://source.unsplash.com/1600x1100/?flower&sig=${i}`);
}
/* auto-generated captions (mix of Hindi/Hinglish short lines) */
const captions = [
  "Phoolon ki khushboo, yaadon ka jashn.",
  "Rangon mein khoya ek pal.",
  "Nature ki muskaan — tumhare liye.",
  "Har phool me kahaani chhupi hai.",
  "Suraj ki roshni aur phoolon ka geet.",
  "Chandni si narmi, phoolon ka saath.",
  "Rang birange pal, yaadgaar lamhe.",
  "Khushiyon se bhara ek guldaan.",
  "Phoolon ki tarah khilte raho.",
  "Pal jo phool se bhi pyare lagte hain.",
  "Hass aur khushboo — dono tumhare liye.",
  "Har phool ek naya ehsaas.",
  "Raunak aur rang, dono saath hain.",
  "Dil se nikla shukriya — phoolon ke naam.",
  "Chhota sa phool, badi si khushi.",
  "Khushiyon ka chota sa phoolon ka mela.",
  "Phool bhi muskurate hain tumhare liye.",
  "Zindagi me phoolon jesi mithaas.",
  "Rangon se bhara hua aangan.",
  "Phoolon ki baarish, dil ki khushi.",
  "Satrangi phool, satrangi yaadein.",
  "Phoolon ki zubaan, dil ki baat.",
  "Meethi khushboo, pyara ehsaas.",
  "Phoolon me chhupa ek muskaan.",
  "Har pal me phoolon ki jagah ho.",
  "Rangon ke saagar me doob jao.",
  "Phoolon ka safar, yaadon ka safar.",
  "Chand sa noor, phoolon ka shor.",
  "Phoolon ki god me sukoon."
];

/* ========== Build UI: create polaroids dynamically ========== */
const playArea = document.getElementById('playArea');
const thumbsEl = document.getElementById('thumbs');
const dotsEl = document.getElementById('dots');
const captionBox = document.getElementById('captionBox');
const overlayRakhi = document.getElementById('overlayRakhi');
const rakhiBar = document.getElementById('rakhiBar');
const rakhiKnot = document.getElementById('rakhiKnot');

let polaroids = [];
let z = 20;
for(let i=0;i<IMAGES_COUNT;i++){
  const el = document.createElement('div');
  el.className = 'polaroid';
  el.dataset.index = i;
  // random start pos inside frame
  const fx = Math.random()*600 - 200;
  const fy = Math.random()*320 - 160;
  el.style.left = (playArea.clientWidth/2 + fx) + 'px';
  el.style.top = (playArea.clientHeight/2 + fy) + 'px';
  el.style.transform = `rotate(${(Math.random()*16-8).toFixed(2)}deg) scale(${1 - Math.random()*0.06})`;
  el.innerHTML = `<img src="${baseUrls[i]}" alt="flower-${i}"><div class="label">${captions[i]||''}</div>`;
  playArea.appendChild(el);
  polaroids.push({el, src: baseUrls[i], caption: captions[i]||''});
  // thumb
  const t = document.createElement('img'); t.src = baseUrls[i]; t.dataset.idx = i;
  t.addEventListener('click', ()=> focusPolaroid(i));
  thumbsEl.appendChild(t);
  // dot
  const d = document.createElement('div'); d.className='dot'; d.dataset.idx=i; d.addEventListener('click', ()=> focusPolaroid(i));
  dotsEl.appendChild(d);
}

/* ========== Drag / physics (simple) ========== */
polaroids.forEach((p, idx)=>{
  const el = p.el;
  let dragging=false, sx=0, sy=0, ox=0, oy=0;
  el.addEventListener('pointerdown', e=>{
    el.setPointerCapture(e.pointerId);
    dragging=true; el.style.cursor='grabbing'; el.style.zIndex = ++z;
    sx = e.clientX; sy = e.clientY;
    const r = el.getBoundingClientRect();
    const frameRect = document.getElementById('frame').getBoundingClientRect();
    ox = r.left - frameRect.left; oy = r.top - frameRect.top;
    el.style.transition = 'none';
  });
  window.addEventListener('pointermove', e=>{
    if(!dragging) return;
    const dx = e.clientX - sx; const dy = e.clientY - sy;
    el.style.left = (ox + dx) + 'px'; el.style.top = (oy + dy) + 'px';
  });
  window.addEventListener('pointerup', e=>{
    if(!dragging) return;
    dragging=false; el.style.cursor='grab';
    el.style.transition = 'transform .5s ease,left .5s ease,top .5s ease';
    // small bounce
    el.style.transform = `rotate(${(Math.random()*6-3)}deg) scale(1)`;
  });
  el.addEventListener('dblclick', ()=> triggerTie(idx));
});

/* ========== Parallax background ========== */
const bgLayer = document.getElementById('bgLayer');
function makeBgPattern(){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><defs><radialGradient id='g'><stop offset='0' stop-color='${'#ffd6a5'}' stop-opacity='0.9'/><stop offset='1' stop-color='${'#fff3e0'}' stop-opacity='0'/></radialGradient></defs><rect width='100%' height='100%' fill='url(#g)' /></svg>`;
  bgLayer.style.backgroundImage = `url('data:image/svg+xml;utf8,${encodeURIComponent(svg)}')`;
  bgLayer.style.backgroundSize = '400px 300px';
  bgLayer.style.opacity = .8;
}
makeBgPattern();
document.getElementById('frame').addEventListener('mousemove', (e)=>{
  const r = e.currentTarget.getBoundingClientRect();
  const cx = (e.clientX - r.left)/r.width - 0.5;
  const cy = (e.clientY - r.top)/r.height - 0.5;
  bgLayer.style.transform = `translate(${cx*12}px, ${cy*12}px) rotate(${cx*2}deg)`;
});

/* ========== Petals canvas animation (floating petals) ========== */
const canvas = document.getElementById('petalsCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){
  const rect = document.getElementById('frame').getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
}
resizeCanvas(); window.addEventListener('resize', resizeCanvas);
function rand(min,max){ return Math.random()*(max-min)+min; }
class Petal {
  constructor(){
    this.reset(true);
  }
  reset(init=false){
    const w = canvas.width, h = canvas.height;
    this.x = rand(0,w);
    this.y = init ? rand(0,h) : rand(-h, -20);
    this.vx = rand(-0.3, 0.8);
    this.vy = rand(0.4, 1.6);
    this.size = rand(6,20);
    this.rot = rand(0,Math.PI*2);
    this.spin = rand(-0.02,0.02);
    this.color = `rgba(255,${Math.floor(rand(120,210))},${Math.floor(rand(140,230))},${rand(0.35,0.95)})`;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
    this.rot += this.spin;
    if(this.y > canvas.height + 30) this.reset();
    if(this.x < -30 || this.x > canvas.width+30) this.reset();
  }
  draw(){
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rot);
    ctx.scale(this.size/20, this.size/20);
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.bezierCurveTo(6,-8, 18,-16, 22,-8);
    ctx.bezierCurveTo(26,-2, 10,6, 0,18);
    ctx.bezierCurveTo(-10,6, -26,-2, -22,-8);
    ctx.bezierCurveTo(-18,-16, -6,-8, 0,0);
    ctx.closePath();
    ctx.fillStyle = this.color;
    ctx.shadowColor = this.color; ctx.shadowBlur = 8;
    ctx.fill();
    ctx.restore();
  }
}
const petals = [];
for(let i=0;i<40;i++) petals.push(new Petal());
function animatePetals(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const p of petals){ p.update(); p.draw(); }
  requestAnimationFrame(animatePetals);
}
animatePetals();

/* ========== Rakhi tie animation ========== */
function triggerTie(index=0){
  const p = polaroids[index];
  if(!p) return;
  const rect = p.el.getBoundingClientRect();
  const frameRect = document.getElementById('frame').getBoundingClientRect();
  const cx = rect.left - frameRect.left + rect.width/2;
  overlayRakhi.style.left = (cx / frameRect.width * 100) + '%';
  overlayRakhi.style.top = (rect.top - frameRect.top + 16) + 'px';
  rakhiBar.style.width = '0';
  rakhiKnot.style.opacity = 0; rakhiKnot.style.transform = 'translateY(-6px) scale(.6)';
  rakhiBar.style.transition = 'width .9s cubic-bezier(.2,.9,.2,1)';
  rakhiKnot.style.transition = 'opacity .5s ease, transform .6s cubic-bezier(.2,.9,.2,1)';
  requestAnimationFrame(()=>{ rakhiBar.style.width = '160px'; });
  setTimeout(()=>{ rakhiKnot.style.opacity = 1; rakhiKnot.style.transform = 'translateY(0) scale(1)'; }, 900);
  captionBox.textContent = p.caption;
}

/* tie button */
document.getElementById('tieBtn').addEventListener('click', ()=> triggerTie( Math.floor(Math.random()*polaroids.length) ));

/* ========== Slideshow auto-focus (montage) ========== */
let index = 0, timer = null;
const dots = document.querySelectorAll('.dot');
function focusPolaroid(i){
  index = i;
  const p = polaroids[i].el;
  const frameRect = document.getElementById('frame').getBoundingClientRect();
  const pRect = p.getBoundingClientRect();
  const tx = (frameRect.width - pRect.width)/2;
  const ty = (frameRect.height - pRect.height)/2;
  p.style.transition = 'left .7s cubic-bezier(.2,.9,.2), top .7s cubic-bezier(.2,.9,.2), transform .7s';
  p.style.left = tx + 'px'; p.style.top = ty + 'px'; p.style.transform = 'rotate(0deg) scale(1.02)';
  captionBox.textContent = polaroids[i].caption;
  triggerTie(i);
  updateDots();
}
function startMontage(){
  if(timer) return;
  timer = setInterval(()=>{ index = (index+1)%polaroids.length; focusPolaroid(index); }, 4200);
  document.getElementById('playBtn').textContent = 'Playing...';
}
function stopMontage(){
  if(timer){ clearInterval(timer); timer=null; document.getElementById('playBtn').textContent = 'Play Montage'; }
}
document.getElementById('playBtn').addEventListener('click', ()=> { if(timer) stopMontage(); else startMontage(); });
document.getElementById('pauseBtn').addEventListener('click', stopMontage);

/* dots update */
function updateDots(){
  const all = document.querySelectorAll('.dot');
  all.forEach(d=>d.classList.remove('active'));
  if(all[index]) all[index].classList.add('active');
}
updateDots();

/* music control */
const bg = document.getElementById('bgAudio');
const musicBtn = document.getElementById('musicBtn');
let musicOn=false;
musicBtn.addEventListener('click', async ()=>{
  try{
    if(!musicOn){ await bg.play(); musicOn=true; musicBtn.textContent='Pause Music'; }
    else { bg.pause(); musicOn=false; musicBtn.textContent='Play Music'; }
  }catch(e){
    alert('Browser requires user interaction to play audio. Tap Play first.');
  }
});

/* ========== Export Offline: fetch all images + audio and build downloadable HTML ========== */
document.getElementById('exportBtn').addEventListener('click', async ()=>{
  const btn = document.getElementById('exportBtn');
  btn.disabled = true; btn.textContent = 'Embedding images... (may take time)';
  try{
    const embedded = [];
    for(const p of polaroids){
      try{
        const data = await fetchAsDataURL(p.src);
        embedded.push({src:data, caption:p.caption});
      }catch(err){
        console.warn('fetch fail', p.src, err);
        embedded.push({src:p.src, caption:p.caption, fetchError:true});
      }
    }
    // audio
    let audioData = null;
    try{ audioData = await fetchAsDataURL(bg.querySelector('source').src); }catch(e){ console.warn('audio fetch fail', e); }

    const failed = embedded.filter(x=>x.fetchError);
    if(failed.length){
      const proceed = confirm(`${failed.length} image(s) could not be embedded due to CORS. Export will keep remote URLs for those images (offline may not work for them). Try desktop Chrome if you want to attempt again. Proceed?`);
      if(!proceed){ btn.disabled=false; btn.textContent='Export Offline'; return; }
    }
    const html = buildStandalone(embedded, audioData);
    downloadFile(html, 'raksha_flowers_30_shared.html', 'text/html');
    btn.textContent = 'Exported ✓ Download started';
    setTimeout(()=>{ btn.disabled=false; btn.textContent='Export Offline'; }, 2500);
  }catch(e){
    alert('Export failed: '+(e.message||e));
    btn.disabled=false; btn.textContent='Export Offline';
  }
});

async function fetchAsDataURL(url){
  const resp = await fetch(url, {mode:'cors'});
  if(!resp.ok) throw new Error('network');
  const blob = await resp.blob();
  return await blobToDataURL(blob);
}
function blobToDataURL(blob){ return new Promise((res,rej)=>{ const r = new FileReader(); r.onload = ()=> res(r.result); r.onerror = rej; r.readAsDataURL(blob); }); }
function downloadFile(content, name, mime){ const blob = new Blob([content], {type:mime}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=name; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

/* build standalone HTML string */
function buildStandalone(list, audioData){
  const payload = JSON.stringify(list).replaceAll('</','<\\/');
  const audioTag = audioData ? `<audio controls loop style="width:100%"><source src="${audioData}"></audio>` : '';
  return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shared — Flowers Montage</title>
  <style>body{margin:0;font-family:system-ui;background:linear-gradient(180deg,#fff7ed,#fff2df);color:#3b2b1a;padding:18px}.wrap{max-width:1100px;margin:0 auto}.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.card{border-radius:10px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.06)}img{width:100%;height:auto;display:block;padding-bottom:6px}.label{padding:8px;font-weight:800;background:#fff}</style>
  </head><body><div class="wrap"><h2>Flower Montage — Shared</h2>${audioTag}<div class="grid" id="grid"></div></div>
  <script>const data = ${payload}; const grid = document.getElementById('grid'); data.forEach(it=>{ const c = document.createElement('div'); c.className='card'; c.innerHTML='<img src=\"'+it.src+'\"><div class=\"label\">'+(it.caption||'')+'</div>'; grid.appendChild(c); });</script></body></html>`;
}

/* small preload images */
(function preload(){ polaroids.forEach(p=>{ const i=new Image(); i.src = p.src; }); })();
</script>
</body>
</html>                name: "Smart Watch",
                price: 199.99,
                category: "electronics",
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Advanced smartwatch with fitness tracking, heart rate monitor, and GPS capabilities."
            },
            {
                id: 3,
                name: "Cotton T-Shirt",
                price: 29.99,
                category: "clothing",
                image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Premium cotton t-shirt available in multiple colors and sizes."
            },
            {
                id: 4,
                name: "Programming Book",
                price: 49.99,
                category: "books",
                image: "https://images.unsplash.com/photo-1532012197267-da84d127e765?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Comprehensive guide to modern web development technologies and best practices."
            },
            {
                id: 5,
                name: "Indoor Plant",
                price: 39.99,
                category: "home",
                image: "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Beautiful indoor plant perfect for home decoration and air purification."
            },
            {
                id: 6,
                name: "Coffee Maker",
                price: 129.99,
                category: "home",
                image: "https://images.unsplash.com/photo-1517256064527-09c73fc73e38?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Automatic coffee maker with programmable settings and thermal carafe."
            },
            {
                id: 7,
                name: "Laptop Backpack",
                price: 79.99,
                category: "electronics",
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Durable laptop backpack with multiple compartments and USB charging port."
            },
            {
                id: 8,
                name: "Running Shoes",
                price: 119.99,
                category: "clothing",
                image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",
                description: "Comfortable running shoes with advanced cushioning and breathable material."
            }
        ];

        // Global state
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentPage = 'home';
        let selectedProduct = null;

        // Navigation functions
        function showPage(page, productId = null) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show selected page
            document.getElementById(page + '-page').classList.add('active');
            currentPage = page;

            // Update active nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-purple-600', 'font-medium');
                link.classList.add('text-gray-700');
            });

            // Page-specific logic
            switch(page) {
                case 'home':
                    loadFeaturedProducts();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'product-detail':
                    if (productId) {
                        selectedProduct = products.find(p => p.id === parseInt(productId));
                        loadProductDetail();
                    }
                    break;
                case 'cart':
                    loadCart();
                    break;
                case 'checkout':
                    loadCheckout();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'login':
                    setupLoginForm();
                    break;
                case 'signup':
                    setupSignupForm();
                    break;
            }

            // Hide mobile menu
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // Product loading functions
        function loadFeaturedProducts() {
            const container = document.getElementById('featured-products');
            const featuredProducts = products.slice(0, 4);
            
            container.innerHTML = featuredProducts.map(product => `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden product-hover transition-all duration-300 cursor-pointer">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover" onclick="showPage('product-detail', ${product.id})">
                    <div class="p-4">
                        <h4 class="font-semibold text-lg mb-2 cursor-pointer hover:text-purple-600" onclick="showPage('product-detail', ${product.id})">
                            ${product.name}
                        </h4>
                        <p class="text-gray-600 text-sm mb-2">
                            ${product.description.substring(0, 80)}...
                        </p>
                        <div class="flex justify-between items-center">
                            <span class="text-2xl font-bold text-purple-600">
                                $${product.price}
                            </span>
                            <button onclick="addToCart(${product.id})" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadProducts() {
            const container = document.getElementById('products-grid');
            let filteredProducts = [...products];

            // Apply filters
            const categoryFilter = document.getElementById('category-filter').value;
            const sortFilter = document.getElementById('sort-filter').value;

            if (categoryFilter) {
                filteredProducts = filteredProducts.filter(p => p.category === categoryFilter);
            }

            if (sortFilter) {
                switch(sortFilter) {
                    case 'price-low':
                        filteredProducts.sort((a, b) => a.price - b.price);
                        break;
                    case 'price-high':
                        filteredProducts.sort((a, b) => b.price - a.price);
                        break;
                    case 'name':
                        filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                }
            }

            container.innerHTML = filteredProducts.map(product => `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden product-hover transition-all duration-300 cursor-pointer">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover" onclick="showPage('product-detail', ${product.id})">
                    <div class="p-4">
                        <h4 class="font-semibold text-lg mb-2 cursor-pointer hover:text-purple-600" onclick="showPage('product-detail', ${product.id})">
                            ${product.name}
                        </h4>
                        <p class="text-gray-600 text-sm mb-2">
                            ${product.description.substring(0, 80)}...
                        </p>
                        <div class="flex justify-between items-center">
                            <span class="text-2xl font-bold text-purple-600">
                                $${product.price}
                            </span>
                            <button onclick="addToCart(${product.id})" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadProductDetail() {
            if (!selectedProduct) return;

            const container = document.getElementById('product-detail-content');
            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div>
                        <img src="${selectedProduct.image}" alt="${selectedProduct.name}" class="w-full h-96 object-cover rounded-lg shadow-lg">
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold mb-4">${selectedProduct.name}</h1>
                        <p class="text-4xl font-bold text-purple-600 mb-6">$${selectedProduct.price}</p>
                        <p class="text-gray-700 mb-6">${selectedProduct.description}</p>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Quantity</label>
                            <select id="quantity-select" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                        
                        <div class="flex space-x-4 mb-8">
                            <button onclick="addToCartWithQuantity(${selectedProduct.id})" class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                                Add to Cart
                            </button>
                            <button onclick="buyNow(${selectedProduct.id})" class="flex-1 bg-gray-800 text-white py-3 rounded-lg font-semibold hover:bg-gray-900 transition-colors">
                                Buy Now
                            </button>
                        </div>
                        
                        <div class="border-t pt-6">
                            <h3 class="font-semibold mb-4">Product Features</h3>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex items-center">✅ High quality materials</li>
                                <li class="flex items-center">✅ Fast shipping</li>
                                <li class="flex items-center">✅ 1-year warranty</li>
                                <li class="flex items-center">✅ 30-day return policy</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cart functions
        function addToCart(productId, quantity = 1) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: quantity
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${product.name} added to cart!`);
        }

        function addToCartWithQuantity(productId) {
            const quantity = parseInt(document.getElementById('quantity-select').value);
            addToCart(productId, quantity);
        }

        function buyNow(productId) {
            addToCartWithQuantity(productId);
            showPage('checkout');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            loadCart();
        }

        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }

            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                loadCart();
            }
        }

        function loadCart() {
            const container = document.getElementById('cart-content');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16">
                        <div class="text-6xl text-gray-300 mb-4">🛒</div>
                        <h3 class="text-2xl font-semibold text-gray-600 mb-4">Your cart is empty</h3>
                        <button onclick="showPage('products')" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                            Continue Shopping
                        </button>
                    </div>
                `;
                return;
            }

            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = subtotal > 50 ? 0 : 9.99;
            const total = subtotal + shipping;

            container.innerHTML = `
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="space-y-4">
                        ${cart.map(item => `
                            <div class="flex items-center space-x-4 border-b pb-4">
                                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                                <div class="flex-1">
                                    <h4 class="font-semibold">${item.name}</h4>
                                    <p class="text-gray-600">$${item.price}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="updateQuantity(${item.id}, ${item.quantity - 1})" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100">-</button>
                                    <span class="w-8 text-center">${item.quantity}</span>
                                    <button onclick="updateQuantity(${item.id}, ${item.quantity + 1})" class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100">+</button>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">$${(item.price * item.quantity).toFixed(2)}</p>
                                    <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">Order Summary</h3>
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between">
                            <span>Subtotal</span>
                            <span>$${subtotal.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Shipping</span>
                            <span>${shipping === 0 ? 'Free' : `$${shipping.toFixed(2)}`}</span>
                        </div>
                        <div class="border-t pt-2 font-semibold text-lg">
                            <div class="flex justify-between">
                                <span>Total</span>
                                <span>$${total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="showPage('checkout')" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                        Proceed to Checkout
                    </button>
                </div>
            `;
        }

        function loadCheckout() {
            const container = document.getElementById('checkout-content');
            
            if (cart.length === 0) {
                container.innerHTML = '<p class="text-gray-600">Your cart is empty</p>';
                return;
            }

            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = subtotal > 50 ? 0 : 9.99;
            const total = subtotal + shipping;

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-6">Shipping Information</h3>
                        <form id="checkout-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                    <input type="text" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                    <input type="text" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                <input type="text" name="address" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                                    <input type="text" name="city" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
                                    <input type="text" name="state" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ZIP Code</label>
                                    <input type="text" name="zip" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                                Place Order
                            </button>
                        </form>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-6">Order Summary</h3>
                        <div class="space-y-3 mb-6">
                            ${cart.map(item => `
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">${item.name}</p>
                                        <p class="text-sm text-gray-600">Qty: ${item.quantity}</p>
                                    </div>
                                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="border-t pt-4 space-y-2">
                            <div class="flex justify-between">
                                <span>Subtotal</span>
                                <span>$${subtotal.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Shipping</span>
                                <span>${shipping === 0 ? 'Free' : `$${shipping.toFixed(2)}`}</span>
                            </div>
                            <div class="border-t pt-2 font-semibold text-lg">
                                <div class="flex justify-between">
                                    <span>Total</span>
                                    <span>$${total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Setup checkout form
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const order = {
                    id: Date.now(),
                    items: [...cart],
                    total: total,
                    date: new Date().toISOString(),
                    status: 'Processing'
                };

                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));

                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();

                showNotification('Order placed successfully!');
                setTimeout(() => {
                    showPage('orders');
                }, 1500);
            });
        }

        // User authentication
        function setupLoginForm() {
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const email = formData.get('email');
                
                currentUser = {
                    email: email,
                    name: 'John Doe'
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showNotification('Login successful!');
                setTimeout(() => {
                    showPage('home');
                }, 1000);
            });
        }

        function setupSignupForm() {
            document.getElementById('signup-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const firstName = formData.get('firstName');
                const lastName = formData.get('lastName');
                const email = formData.get('email');
                const password = formData.get('password');
                const confirmPassword = formData.get('confirmPassword');

                if (password !== confirmPassword) {
                    showNotification('Passwords do not match', 'error');
                    return;
                }

                currentUser = {
                    email: email,
                    name: `${firstName} ${lastName}`
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showNotification('Account created successfully!');
                setTimeout(() => {
                    showPage('home');
                }, 1000);
            });
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showNotification('Logged out successfully');
            showPage('login');
        }

        // Profile and orders
        function loadProfile() {
            const container = document.getElementById('profile-content');
            
            if (!currentUser) {
                container.innerHTML = `
                    <div class="text-center py-16">
                        <h3 class="text-2xl font-semibold text-gray-600 mb-4">Please login to view your profile</h3>
                        <button onclick="showPage('login')" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                            Login
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-white text-2xl">👤</span>
                            </div>
                            <h3 class="text-xl font-semibold">${currentUser.name}</h3>
                            <p class="text-gray-600">${currentUser.email}</p>
                        </div>
                        <div class="space-y-3">
                            <button class="w-full text-left px-4 py-2 rounded hover:bg-gray-100 flex items-center bg-gray-100">
                                👤 Personal Info
                            </button>
                            <button onclick="showPage('orders')" class="w-full text-left px-4 py-2 rounded hover:bg-gray-100 flex items-center">
                                🛍️ My Orders
                            </button>
                            <button onclick="logout()" class="w-full text-left px-4 py-2 rounded hover:bg-gray-100 text-red-600 flex items-center">
                                🚪 Logout
                            </button>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-6">Personal Information</h3>
                        <form class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                    <input type="text" value="John" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                    <input type="text" value="Doe" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" value="${currentUser.email}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" value="+1 (555) 123-4567" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-600">
                            </div>
                            <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function loadOrders() {
            const container = document.getElementById('orders-content');
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16">
                        <div class="text-6xl text-gray-300 mb-4">🛍️</div>
                        <h3 class="text-2xl font-semibold text-gray-600 mb-4">No orders yet</h3>
                        <button onclick="showPage('products')" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                            Start Shopping
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="space-y-6">
                    ${orders.reverse().map(order => `
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold">Order #${order.id}</h3>
                                    <p class="text-gray-600">${new Date(order.date).toLocaleDateString()}</p>
                                </div>
                                <span class="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                    ${order.status}
                                </span>
                            </div>
                            <div class="space-y-2 mb-4">
                                ${order.items.map(item => `
                                    <div class="flex justify-between items-center">
                                        <span>${item.name} x ${item.quantity}</span>
                                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="border-t pt-4 flex justify-between items-center">
                                <span class="font-semibold">Total: $${order.total.toFixed(2)}</span>
                                <button onclick="showNotification('Order tracking feature coming soon!')" class="text-purple-600 hover:underline">
                                    Track Order
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Utility functions
        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
            document.getElementById('mobile-cart-count').textContent = count;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 z-50 ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            } text-white translate-x-0`;
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
            }, 3000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });

            // Product filter listeners
            document.getElementById('category-filter').addEventListener('change', loadProducts);
            document.getElementById('sort-filter').addEventListener('change', loadProducts);

            // Initialize
            updateCartCount();
            loadFeaturedProducts();
        });
    </script>
</body>
</html>
